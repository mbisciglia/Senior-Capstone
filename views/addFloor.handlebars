<!DOCTYPE html>
<html>
<body>

<div class="container-fluid">
	<div class="row">
<div class="col-md-4">
			<form role="form">
				<div class="form-group">
					 
				</div>
				<div class="form-group">
					<label for="addfloor">
						Add Floor
					</label>
					<input class="form-control" id="addfloor" />
				</div>
				<div class="form-group">
					 
					<label for="file">
						File input
					</label>
					<input type="file" class="form-control-file" id="file" />
					<p class="help-block">
                        Input an image along with new floor name to create new map
					</p>

					<p id="doug-help-plz">
						ask about promises - async calls to db for ret uploaded iamge. 
						also persistance and how to deal with users correctly. 
						Might include sending email and pass to each page to resign in?
				
						
					</p>
				</div>
				<button type="submit" id="submit" class="btn btn-primary">
					Submit
				</button>
			</form>
		</div>
		<div class="col-md-8">
			<img id="image" alt="Bootstrap Image Preview" src="https://i.redd.it/uo0u67glvlq01.jpg" />
		</div>
	</div>
</div>

</body> 
</html> 

<script>    

    document.getElementById('submit').addEventListener('click', (event) => {
        event.preventDefault();
        var file = document.getElementById('file').files[0];
		const floor = document.getElementById('addfloor').value;
		if(floor == null || file == null)
		{
			alert("You must input a floor name and an image.");
			return;
		}
		file = new File([file], floor, {type: 'image/png'});



        var storageRef = firebase.storage().ref();
        var ref = storageRef.child("images/testAcc/"+file);
        ref.put(file).then(function(snapshot) {
        console.log('Uploaded a blob or file!');
        });

		ref.getDownloadURL().then(function(url) {
		// `url` is the download URL for 'images/stars.jpg'

		// This can be downloaded directly:
		var xhr = new XMLHttpRequest();
		xhr.responseType = 'blob';
		xhr.onload = function(event) {
		var blob = xhr.response;
		};
		xhr.open('GET', url);
		xhr.send();

		// Or inserted into an <img> element:
		var img = document.getElementById('image');
			img.src = url;
		}).catch(function(error) {
			console.log(error);
			console.log("there was an error getting images");
		});
		});

</script>